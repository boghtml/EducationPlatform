import React, { useState, useEffect, useRef } from 'react';
import { Link } from 'react-router-dom';
import Header from './Header';
import Footer from './Footer';
import '../css/FAQ.css';
import { 
  FaChevronDown, FaChevronUp, FaQuestionCircle, 
  FaBookOpen, FaShieldAlt, FaUserGraduate, FaMoneyBillWave, 
  FaLaptopCode, FaCertificate, FaRegCreditCard, FaSearch
} from 'react-icons/fa';

const FAQ = () => {
  // Стан для фільтрації питань
  const [activeCategory, setActiveCategory] = useState('all');
  const [searchQuery, setSearchQuery] = useState('');
  const [expandedFaqs, setExpandedFaqs] = useState({});
  const searchInputRef = useRef(null);
  
  // Створюємо категорії з іконками
  const categories = [
    { id: 'all', name: 'Всі питання', icon: <FaQuestionCircle /> },
    { id: 'general', name: 'Загальні питання', icon: <FaBookOpen /> },
    { id: 'account', name: 'Обліковий запис', icon: <FaShieldAlt /> },
    { id: 'courses', name: 'Курси та навчання', icon: <FaUserGraduate /> },
    { id: 'payment', name: 'Оплата та ціни', icon: <FaMoneyBillWave /> },
    { id: 'technical', name: 'Технічні питання', icon: <FaLaptopCode /> },
    { id: 'certificate', name: 'Сертифікація', icon: <FaCertificate /> }
  ];
  
  // Масив питань та відповідей
  const faqs = [
    {
      id: 1,
      question: 'Що таке Освітня платформа?',
      answer: 'Освітня платформа — це сучасний онлайн-ресурс для навчання, який надає доступ до якісних освітніх матеріалів та курсів з різних напрямків. Наша місія — зробити освіту доступною для кожного, незалежно від місця проживання чи фінансових можливостей. Платформа пропонує як безкоштовні, так і преміум курси з можливістю отримання сертифікатів.',
      category: 'general'
    },
    {
      id: 2,
      question: 'Як зареєструватися на платформі?',
      answer: 'Щоб зареєструватися на нашій платформі, натисніть кнопку "Зареєструватися" у верхньому правому куті сайту. Заповніть форму реєстрації, вказавши своє ім\'я, електронну пошту та пароль. Після цього ви отримаєте лист для підтвердження електронної пошти. Перейдіть за посиланням у листі, щоб активувати свій обліковий запис. Після активації ви зможете увійти в систему та отримати доступ до всіх функцій платформи.',
      category: 'account'
    },
    {
      id: 3,
      question: 'Як відновити забутий пароль?',
      answer: 'Якщо ви забули пароль, перейдіть на сторінку входу та натисніть посилання "Забули пароль?". Введіть електронну пошту, яку ви використовували при реєстрації, і ми надішлемо вам інструкції з відновлення паролю. Перевірте вашу поштову скриньку (а також папку "Спам") та дотримуйтесь інструкцій у листі. Якщо ви не отримали лист протягом 10 хвилин, спробуйте повторити процес або зверніться до нашої служби підтримки.',
      category: 'account'
    },
    {
      id: 4,
      question: 'Чи можу я навчатися безкоштовно?',
      answer: 'Так, на нашій платформі доступно багато безкоштовних курсів. Вони позначені міткою "Безкоштовно" у каталозі курсів. Безкоштовні курси включають відеолекції, навчальні матеріали та базові тести. Для отримання доступу до розширених функцій, таких як сертифікати, особисті консультації з викладачами та додаткові практичні завдання, рекомендуємо розглянути наші преміум курси.',
      category: 'courses'
    },
    {
      id: 5,
      question: 'Як працює система сертифікації?',
      answer: 'Після успішного завершення курсу (виконання всіх завдань та проходження фінального тесту) ви отримуєте електронний сертифікат. Для безкоштовних курсів доступні базові сертифікати про проходження курсу. Для преміум курсів видаються верифіковані сертифікати з унікальним ідентифікатором, який роботодавці можуть перевірити на нашому сайті. Деякі курси також пропонують сертифікати, акредитовані професійними асоціаціями та навчальними закладами.',
      category: 'certificate'
    },
    {
      id: 6,
      question: 'Які способи оплати доступні?',
      answer: 'Ми підтримуємо різні способи оплати, включаючи банківські картки (Visa, Mastercard), PayPal, Google Pay, Apple Pay та банківські перекази. Для деяких курсів доступна оплата частинами без додаткових відсотків. Усі платежі обробляються через захищене з\'єднання з використанням сучасних технологій шифрування. Ми не зберігаємо повні дані ваших платіжних карток на наших серверах.',
      category: 'payment'
    },
    {
      id: 7,
      question: 'Чи можна отримати повернення коштів?',
      answer: 'Так, ми пропонуємо гарантію повернення коштів протягом 14 днів після оплати курсу, якщо ви не переглянули більше 30% вмісту курсу. Для підписок відшкодування можливе протягом 7 днів з моменту оплати. Щоб запросити повернення, зверніться до служби підтримки через розділ "Контакти" із зазначенням деталей вашого запиту. Обробка запиту на повернення коштів зазвичай займає 3-5 робочих днів.',
      category: 'payment'
    },
    {
      id: 8,
      question: 'Які технічні вимоги для використання платформи?',
      answer: 'Для комфортного навчання на нашій платформі рекомендуємо використовувати сучасний веб-браузер (Google Chrome, Mozilla Firefox, Safari, Microsoft Edge) та стабільне інтернет-з\'єднання зі швидкістю від 5 Мбіт/с. Платформа адаптована для використання на комп\'ютерах, планшетах та смартфонах. Для деяких спеціалізованих курсів (наприклад, з програмування або 3D-моделювання) можуть бути додаткові вимоги, які вказані на сторінці конкретного курсу.',
      category: 'technical'
    },
    {
      id: 9,
      question: 'Як отримати технічну підтримку?',
      answer: 'Якщо у вас виникли технічні проблеми, ви можете отримати допомогу кількома способами. Перегляньте нашу базу знань у розділі FAQ, де зібрані відповіді на найпоширеніші питання. Якщо ви не знайшли відповідь, зверніться до нашої служби підтримки через форму зворотного зв\'язку в розділі "Контакти" або надішліть електронний лист на адресу support@educationplatform.com. Наша команда відповість протягом 24 годин у робочі дні.',
      category: 'technical'
    },
    {
      id: 10,
      question: 'Чи можна завантажити навчальні матеріали для офлайн-перегляду?',
      answer: 'Так, більшість навчальних матеріалів на нашій платформі доступні для завантаження та офлайн-перегляду. Це стосується презентацій, документів PDF та додаткових матеріалів. Відеолекції також можна завантажити у мобільному додатку для офлайн-перегляду, якщо ви маєте активну підписку на преміум-доступ. Зверніть увагу, що завантажені матеріали захищені авторським правом і призначені лише для особистого використання.',
      category: 'courses'
    },
    {
      id: 11,
      question: 'Як довго я матиму доступ до купленого курсу?',
      answer: 'Після оплати курсу ви отримуєте довічний доступ до всіх його матеріалів. Ви можете повертатися до них у будь-який час. Важливо зазначити, що деякі курси можуть оновлюватися з часом, щоб відображати актуальну інформацію. У випадку значних оновлень курсу ви будете повідомлені електронною поштою. Для курсів, доступних за підпискою, доступ зберігається протягом активного періоду підписки.',
      category: 'courses'
    },
    {
      id: 12,
      question: 'Чи є у вас корпоративні тарифи?',
      answer: 'Так, ми пропонуємо спеціальні корпоративні тарифи для компаній, які хочуть навчати своїх співробітників. Корпоративні плани включають доступ до всіх курсів платформи або до спеціально відібраних курсів відповідно до потреб компанії, панель адміністратора для відстеження прогресу співробітників, можливість створення брендованих сертифікатів та індивідуальну технічну підтримку. Для отримання детальної інформації, будь ласка, зв\'яжіться з нашим відділом продажів.',
      category: 'payment'
    },
    {
      id: 13,
      question: 'Як стати викладачем на платформі?',
      answer: 'Ми завжди раді талановитим викладачам, які хочуть ділитися своїми знаннями. Щоб стати викладачем, заповніть заявку в розділі "Викладачам" на нашому сайті. У заявці вкажіть вашу освіту, досвід роботи, сферу експертизи та ідеї курсів, які ви хотіли б створити. Наша команда розгляне вашу заявку і зв\'яжеться з вами протягом 5 робочих днів. Для затверджених викладачів ми надаємо навчання з використання нашої платформи та інструментів для створення якісних освітніх матеріалів.',
      category: 'general'
    },
    {
      id: 14,
      question: 'Чи видаються офіційні документи про освіту?',
      answer: 'Наша платформа не є акредитованим навчальним закладом і не видає офіційні дипломи або свідоцтва про освіту державного зразка. Однак ми співпрацюємо з багатьма акредитованими університетами та професійними організаціями. Деякі курси на нашій платформі розроблені спільно з ними і дають можливість отримати офіційні сертифікати цих установ. Інформація про тип сертифікату завжди вказана на сторінці курсу перед придбанням.',
      category: 'certificate'
    },
    {
      id: 15,
      question: 'Чи можна змінити мову інтерфейсу платформи?',
      answer: 'Так, наша платформа підтримує кілька мов інтерфейсу. За замовчуванням використовується мова, яка відповідає вашим налаштуванням браузера. Щоб змінити мову, увійдіть в свій обліковий запис, перейдіть до розділу "Налаштування" і виберіть бажану мову зі списку доступних. На даний момент підтримуються українська, англійська, польська, німецька та французька мови. Ми постійно працюємо над додаванням нових мов.',
      category: 'technical'
    },
    {
      id: 16,
      question: 'Як відстежувати свій прогрес у навчанні?',
      answer: 'Ваш прогрес у навчанні автоматично відстежується на платформі. На панелі керування ви можете бачити загальний прогрес за всіма курсами, на які ви записані, а також детальну статистику по кожному курсу окремо. Ви можете бачити, які уроки завершені, результати тестів, виконані завдання та загальний відсоток проходження курсу. Крім того, система надсилає щотижневі звіти про прогрес на вашу електронну пошту, якщо ця опція увімкнена в налаштуваннях.',
      category: 'courses'
    },
    {
      id: 17,
      question: 'Чи є мобільний додаток?',
      answer: 'Так, ми маємо офіційні мобільні додатки для iOS та Android, які можна завантажити з App Store та Google Play Store. Мобільні додатки пропонують усі основні функції веб-версії платформи, а також додаткові можливості, такі як завантаження відеолекцій для офлайн-перегляду, push-повідомлення про важливі події та оптимізований інтерфейс для мобільних пристроїв. Синхронізація прогресу відбувається автоматично між усіма вашими пристроями.',
      category: 'technical'
    },
    {
      id: 18,
      question: 'Чи є знижки для студентів та викладачів?',
      answer: 'Так, ми надаємо спеціальні знижки для студентів та викладачів акредитованих навчальних закладів. Щоб отримати знижку, потрібно пройти верифікацію через сервіс SheerID або надіслати скан студентського квитка чи довідки з місця роботи на нашу електронну пошту. Після верифікації ви отримаєте знижку 30% на всі платні курси та 20% на річну підписку. Знижка діє протягом навчального року і може бути продовжена при наданні актуальних документів.',
      category: 'payment'
    },
    {
      id: 19,
      question: 'Як забезпечується безпека моїх персональних даних?',
      answer: 'Ми приділяємо велику увагу захисту персональних даних наших користувачів. Усі дані передаються через захищене SSL-з\'єднання. Паролі зберігаються у зашифрованому вигляді і не доступні навіть співробітникам платформи. Ми не передаємо ваші персональні дані третім сторонам без вашої згоди, окрім випадків, передбачених законодавством. Наша політика конфіденційності відповідає вимогам GDPR та інших міжнародних стандартів захисту даних. Ви можете ознайомитися з нею у розділі "Політика конфіденційності".',
      category: 'account'
    },
    {
      id: 20,
      question: 'Як отримати рахунок-фактуру для юридичної особи?',
      answer: 'Для отримання рахунку-фактури для юридичної особи, будь ласка, зв\'яжіться з нашим відділом бухгалтерії за адресою finance@educationplatform.com або через форму зворотного зв\'язку в розділі "Контакти". У запиті вкажіть повну назву компанії, юридичну адресу, податковий номер, контактні дані та деталі замовлення (назви курсів, кількість ліцензій тощо). Ми підготуємо необхідні документи і надішлемо їх вам протягом 1-2 робочих днів.',
      category: 'payment'
    }
  ];
  
  // Встановлюємо заголовок сторінки
  useEffect(() => {
    document.title = "Часті запитання | Освітня платформа";
    window.scrollTo(0, 0);
  }, []);
  
  // Фільтруємо питання за категорією та пошуковим запитом
  const filteredFaqs = faqs.filter((faq) => {
    const matchesCategory = activeCategory === 'all' || faq.category === activeCategory;
    const matchesSearch = searchQuery === '' || 
      faq.question.toLowerCase().includes(searchQuery.toLowerCase()) || 
      faq.answer.toLowerCase().includes(searchQuery.toLowerCase());
    
    return matchesCategory && matchesSearch;
  });
  
  // Переключення відображення відповіді на питання
  const toggleFaq = (faqId) => {
    setExpandedFaqs((prev) => ({
      ...prev,
      [faqId]: !prev[faqId]
    }));
  };
  
  // Функція для фокусування на полі пошуку
  const focusSearchInput = () => {
    if (searchInputRef.current) {
      searchInputRef.current.focus();
    }
  };
  
  // Очищення пошукового запиту
  const clearSearch = () => {
    setSearchQuery('');
    focusSearchInput();
  };
  
  // Групування питань за категоріями
  const getFaqCountByCategory = () => {
    const counts = { all: faqs.length };
    
    faqs.forEach((faq) => {
      if (counts[faq.category]) {
        counts[faq.category]++;
      } else {
        counts[faq.category] = 1;
      }
    });
    
    return counts;
  };
  
  const faqCounts = getFaqCountByCategory();

  return (
    <div className="faq-page">
      <Header />
      
      <div className="faq-hero">
        <div className="container">
          <h1 className="faq-hero-title">Часті запитання</h1>
          <p className="faq-hero-subtitle">
            Знайдіть відповіді на найпоширеніші питання про нашу платформу
          </p>
          
          <div className="faq-search">
            <div className="search-input-wrapper">
              <FaSearch className="search-icon" />
              <input
                type="text"
                ref={searchInputRef}
                placeholder="Пошук у запитаннях..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="search-input"
              />
              {searchQuery && (
                <button className="clear-search" onClick={clearSearch}>
                  &times;
                </button>
              )}
            </div>
          </div>
        </div>
      </div>
      
      <div className="container faq-container">
        <div className="faq-sidebar">
          <nav className="category-nav">
            <h3>Категорії</h3>
            <ul className="category-list">
              {categories.map((category) => (
                <li key={category.id}>
                  <button
                    className={`category-button ${activeCategory === category.id ? 'active' : ''}`}
                    onClick={() => setActiveCategory(category.id)}
                  >
                    <span className="category-icon">{category.icon}</span>
                    <span className="category-name">{category.name}</span>
                    <span className="category-count">{faqCounts[category.id] || 0}</span>
                  </button>
                </li>
              ))}
            </ul>
          </nav>
          
          <div className="contact-support">
            <h3>Не знайшли відповідь?</h3>
            <p>Наша команда підтримки готова допомогти вам з будь-якими питаннями</p>
            <Link to="/contact" className="contact-button">
              Зв'язатися з нами
            </Link>
          </div>
        </div>
        
        <div className="faq-content">
          {searchQuery && (
            <div className="search-results-info">
              {filteredFaqs.length > 0 ? (
                <p>Знайдено {filteredFaqs.length} результатів для "{searchQuery}"</p>
              ) : (
                <p>Результатів для "{searchQuery}" не знайдено. Спробуйте інший запит.</p>
              )}
            </div>
          )}
          
          {filteredFaqs.length > 0 ? (
            <div className="faq-list">
              {filteredFaqs.map((faq) => (
                <div 
                  key={faq.id} 
                  className={`faq-item ${expandedFaqs[faq.id] ? 'expanded' : ''}`}
                >
                  <button 
                    className="faq-question" 
                    onClick={() => toggleFaq(faq.id)}
                    aria-expanded={expandedFaqs[faq.id]}
                  >
                    <span className="question-text">{faq.question}</span>
                    <span className="toggle-icon">
                      {expandedFaqs[faq.id] ? <FaChevronUp /> : <FaChevronDown />}
                    </span>
                  </button>
                  
                  <div className="faq-answer">
                    <p>{faq.answer}</p>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="no-results">
              <div className="no-results-icon">
                <FaQuestionCircle />
              </div>
              <h3>Нічого не знайдено</h3>
              <p>
                Спробуйте змінити фільтри або пошуковий запит. Якщо вам все ще потрібна допомога,
                будь ласка, <Link to="/contact">зв'яжіться з нами</Link>.
              </p>
            </div>
          )}
          
          <div className="faq-footer">
            <div className="faq-footer-content">
              <h3>Не знайшли потрібну інформацію?</h3>
              <p>
                Наша команда підтримки завжди готова допомогти вам із будь-якими
                питаннями чи проблемами
              </p>
              <div className="faq-footer-actions">
                <Link to="/contact" className="contact-button">
                  Зв'язатися з нами
                </Link>
                <a href="mailto:support@educationplatform.com" className="mail-link">
                  support@educationplatform.com
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <Footer />
    </div>
  );
};

export default FAQ;